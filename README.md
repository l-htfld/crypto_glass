# OKX Order Book Collector

Этот проект собирает стаканы ордеров с биржи OKX через WebSocket, обрабатывает данные и сохраняет их в памяти.

## Установка

1. Клонируйте репозиторий:

```
git clone <url>
cd okx-orderbook
```
2.Установите зависимости:

```
pip install -r requirements.txt
```
3. Запустите скрипт:

```
python orderbook_collector.py
```
Это подключит вас к WebSocket и начнёт собирать данные о стаканах для доступных инструментов.

### Объяснение:
1. **WebSocket и подписка на стаканы** — Подключение к WebSocket и подписка на каналы для каждого инструмента.
2. **Обработка данных** — Данные о стаканах обновляются и сохраняются в кэше (в памяти с использованием `SortedDict`).
3. **Переподключение и backoff** — В случае ошибок и обрывов WebSocket происходит переподключение с экспоненциальной задержкой.
4. **Логирование** — Все действия логируются, включая успешные подписки и обновления стаканов.


# Установка и запуск с использованием Docker

Чтобы запустить проект с использованием Docker, выполните следующие шаги:

1. Клонируйте репозиторий

```bash
git clone https://github.com/your-username/okx-order-book-collector.git
cd okx-order-book-collector
```
1.1 Установите зависимости:
```
pip install -r requirements.txt
```

2. Настройте Docker

Для использования Docker, вам нужно создать два контейнера:
- Контейнер с приложением.
- Контейнер с Redis (если он еще не настроен).

2.1. Создайте Docker-образа для приложения

Создайте Docker-образ для вашего приложения:

```bash
docker build -t okx-order-book-collector .
```

2.2. Запустите Redis в Docker

Запустите контейнер Redis:

```bash
docker run --name redis -d redis:latest
```

2.3. Запустите приложения

Запустите контейнер с приложением:

```bash
docker run --name order-book-collector --link redis -e REDIS_URL=redis://redis:6379 -p 5000:5000 -d okx-order-book-collector
```

- `--link redis`: связывает контейнер с Redis.
- `REDIS_URL=redis://redis:6379`: устанавливает URL для подключения к Redis.
- `-p 5000:5000`: перенаправляет порты для приложения (при необходимости, укажите порты для связи с API).

3. Проверка

После того как контейнеры будут запущены, приложение начнет получать данные ордербуков с OKX и сохранять их в Redis. Вы можете отслеживать логи с помощью команды:

```bash
docker logs -f order-book-collector
```

4. Завершение работы

Для остановки контейнеров используйте команды:

```bash
docker stop order-book-collector
docker stop redis
```

Чтобы удалить контейнеры:

```bash
docker rm order-book-collector
docker rm redis
```

## Зависимости

- `aiohttp==3.8.1`: Асинхронный HTTP-клиент для работы с REST API и WebSocket.
- `backoff==1.10.0`: Библиотека для обработки повторных попыток при ошибках соединения.
- `sortedcontainers==2.4.0`: Модуль для работы с отсортированными контейнерами.
- `nest-asyncio==1.5.1`: Библиотека для работы с асинхронным кодом в интерактивных средах.
- `redis==4.5.1`: Клиент Redis для Python, используемый для хранения данных ордербуков.

