# OKX Order Book Collector

Этот проект собирает стаканы ордеров с биржи OKX через WebSocket, обрабатывает данные и сохраняет их в памяти.

## Установка

1. Клонируйте репозиторий:

```
git clone https://github.com/l-htfld/crypto_glass.git
cd crypto_glass
```
2.Установите зависимости:

```
pip install -r requirements.txt
```
3. Запустите скрипт:

```
python main_dict.py
```
Это подключит вас к WebSocket и начнёт собирать данные о стаканах для доступных инструментов. Данные сохраняются в JSON-формате.

### Объяснение:
1. **WebSocket и подписка на стаканы** — Подключение к WebSocket и подписка на каналы для каждого инструмента.
2. **Обработка данных** — Данные о стаканах обновляются и сохраняются в кэше (в памяти с использованием `SortedDict`).
3. **Переподключение и backoff** — В случае ошибок и обрывов WebSocket происходит переподключение с экспоненциальной задержкой.
4. **Логирование** — Все действия логируются, включая успешные подписки и обновления стаканов.


# Установка и запуск с использованием Docker

Чтобы запустить проект с использованием Docker, выполните следующие шаги:

1. Клонируйте репозиторий

```bash
git clone https://github.com/l-htfld/crypto_glass.git
cd crypto_glass
```
1.1 Установите зависимости:
```
pip install -r requirements.txt
```

2. Запустите Redis (Docker):
```
docker run -d --name my-redis -p 6379:6379 redis
```

3.Запустите сборщик данных:
```
python main_doc.py
```

## Логирование
Топ-5 уровней bids и asks выводятся в консоль и файл orderbook.log:
```
2025-02-10 12:34:56,789 - INFO - Updated BTC-USDT | Bids: ['96419.10:0.0342', ...] | Asks: ['96426.00:0.2178', ...]
```

## Проверка данных в Redis
1. Подключитесь к Redis CLI:
```
docker exec -it my-redis redis-cli
```
2. Выполните команды:
```
KEYS *
HGETALL orderbook:BTC-USDT
ZRANGE orderbook:BTC-USDT:bids 0 -1 WITHSCORES
```

## Зависимости

- `aiohttp==3.8.1`: Асинхронный HTTP-клиент для работы с REST API и WebSocket.
- `backoff==1.10.0`: Библиотека для обработки повторных попыток при ошибках соединения.
- `sortedcontainers==2.4.0`: Модуль для работы с отсортированными контейнерами.
- `nest-asyncio==1.5.1`: Библиотека для работы с асинхронным кодом в интерактивных средах.
- `redis==4.5.1`: Клиент Redis для Python, используемый для хранения данных ордербуков.
